# Create custom domain for CloudFront

AWS CloudFront is a CDN and it has a randomly generated URL. It often changes if the resource gets updated via Cloudformation deployment.

If you are using the CloudFront as a front facing interface, the URL generated by it is definitely not suitable to be use. To overcome this, you need to assigned a custom domain to it to abstract away the generated URL.

## Stack

The following demonstrate how to configure the above...

### S3 Origins

CloudFront default behavior origin can be set to point to an S3 Bucket where it can be use as a website URL. 

#### CDK

Import all the dependencies...

```typescript
import * as cdk from '@aws-cdk/core';
import { Certificate, CertificateValidation } from '@aws-cdk/aws-certificatemanager';
import { ARecord, HostedZone, RecordTarget } from '@aws-cdk/aws-route53';
import { CloudFrontTarget } from '@aws-cdk/aws-route53-targets';
import { Distribution, HttpVersion, SecurityPolicyProtocol } from '@aws-cdk/aws-cloudfront';
import { S3Origin } from '@aws-cdk/aws-cloudfront-origins';
import { Bucket } from '@aws-cdk/aws-s3';

```



Configure the bucket...

```typescript
const bucket = new Bucket(this, `${id}-app-bucket`, {
      bucketName: 'example-app' + this.account
})
```



Setup the hosted zone and certificate...

```typescript
const hostedzone = new HostedZone(this, `${id}-hostedzone`, {
      zoneName: domainName
})

const certificate = new Certificate(this, `${id}-certificate`, {
    domainName,
    validation: CertificateValidation.fromDns(hostedzone)
});
```



At this point you have 2 options to go with...

1. [CloudFront Distribution](####CloudFront Distribution)

2. [CloudFrontWebDistribution](####CloudFrontWebDistribution)

   

#### CloudFront Distribution

Create the CloudFront distribution for the S3 Bucket...

```typescript
const cloudfront = new Distribution(this, `${id}-distribution`, {
      defaultBehavior: {
        origin: new S3Origin(bucket)
      },
      domainNames: [domainName],
      certificate: certificate,
      httpVersion: HttpVersion.HTTP2,
      minimumProtocolVersion: SecurityPolicyProtocol.TLS_V1_2_2021
})
```



#### CloudFrontWebDistribution

Create the CloudFrontWebDistribution for the S3 Bucket...

```typescript
const cloudfront = new CloudFrontWebDistribution(this, `${id}-web-distribution`, {
      originConfigs: [
      {
        s3OriginSource: {
          s3BucketSource: bucket,
          originPath: 'index.html'
        },
        behaviors: [
          {
            isDefaultBehavior: true
          }
        ]
      }
      ],
      viewerCertificate: {
        aliases: [domainName],
        props: {
          acmCertificateArn: certificate.certificateArn,
          minimumProtocolVersion: SecurityPolicyProtocol.TLS_V1_2_2021
        }
      }
    }) 
```



Map the domain to the CloudFront distribution and you should be done.

```typescript
new ARecord(this, `${id}-alias-record`, {
      zone: HostedZone.fromLookup(this, `${id}-hostedzone`, {
        domainName
      }),
      target: RecordTarget.fromAlias(
        new CloudFrontTarget(cloudfront)
      )
})
```



---

**Note**

CloudFront will only use certificate from `us-east-1` region. So you will either need to deploy all your stacks in the region or reference it from there.

---

