# Create custom domain for CloudFront

AWS CloudFront is a CDN and it has a randomly generated URL. It often changes if the resource gets updated via Cloudformation deployment.

If you are using the CloudFront as a front facing interface, the URL generated by it is definitely not suitable to be use. To overcome this, you need to assigned a custom domain to it to abstract away the generated URL.

## Stack

The following demonstrate how to configure the above...

### S3 Origins

CloudFront default behavior origin can be set to point to an S3 Bucket where it can be use as a website URL. 

#### CDK

Import all the dependencies...

```typescript
import * as cdk from '@aws-cdk/core';
import { Certificate, CertificateValidation } from '@aws-cdk/aws-certificatemanager';
import { ARecord, HostedZone, RecordTarget } from '@aws-cdk/aws-route53';
import { CloudFrontTarget } from '@aws-cdk/aws-route53-targets';
import { Distribution, HttpVersion, SecurityPolicyProtocol } from '@aws-cdk/aws-cloudfront';
import { S3Origin } from '@aws-cdk/aws-cloudfront-origins';
import { Bucket } from '@aws-cdk/aws-s3';

```



Configure the bucket...

```typescript
const bucket = new Bucket(this, `${id}-app-bucket`, {
      bucketName: 'example-app' + this.account
})
```



Setup the hosted zone and certificate...

```typescript
const hostedzone = new HostedZone(this, `${id}-hostedzone`, {
      zoneName: domainName
})

const certificate = new Certificate(this, `${id}-certificate`, {
    domainName,
    validation: CertificateValidation.fromDns(hostedzone)
});
```



Create the CloudFront distribution for the S3 Bucket...

```typescript
const cloudfront = new Distribution(this, `${id}-distribution`, {
      defaultBehavior: {
        origin: new S3Origin(bucket)
      },
      domainNames: [domainName],
      certificate: certificate,
      httpVersion: HttpVersion.HTTP2,
      minimumProtocolVersion: SecurityPolicyProtocol.TLS_V1_2_2021
})
```



Map the domain to the CloudFront distribution...

```typescript
new ARecord(this, `${id}-alias-record`, {
      zone: HostedZone.fromLookup(this, `${id}-hostedzone`, {
        domainName
      }),
      target: RecordTarget.fromAlias(
        new CloudFrontTarget(cloudfront)
      )
})
```



The full code should look something like the following...

```typescript
import * as cdk from '@aws-cdk/core';
import { Certificate, CertificateValidation } from '@aws-cdk/aws-certificatemanager';
import { ARecord, HostedZone, RecordTarget } from '@aws-cdk/aws-route53';
import { CloudFrontTarget } from '@aws-cdk/aws-route53-targets';
import { Distribution, HttpVersion, SecurityPolicyProtocol } from '@aws-cdk/aws-cloudfront';
import { S3Origin } from '@aws-cdk/aws-cloudfront-origins';
import { Bucket } from '@aws-cdk/aws-s3';

export class CloudfrontCustomDomainStack extends cdk.Stack {
  constructor(scope: cdk.Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    const domainName: string = 'example-domain.com';

    const bucket = new Bucket(this, `${id}-app-bucket`, {
      bucketName: 'example-app' + this.account
    })

    const hostedzone = new HostedZone(this, `${id}-hostedzone`, {
      zoneName: domainName
    })

    const certificate = new Certificate(this, `${id}-certificate`, {
      domainName,
      validation: CertificateValidation.fromDns(hostedzone)
    });

    const cloudfront = new Distribution(this, `${id}-distribution`, {
      defaultBehavior: {
        origin: new S3Origin(bucket)
      },
      domainNames: [domainName],
      certificate: certificate,
      httpVersion: HttpVersion.HTTP2,
      minimumProtocolVersion: SecurityPolicyProtocol.TLS_V1_2_2021
    })

    new ARecord(this, `${id}-alias-record`, {
      zone: HostedZone.fromLookup(this, `${id}-hostedzone`, {
        domainName
      }),
      target: RecordTarget.fromAlias(
        new CloudFrontTarget(cloudfront)
      )
    })
  }
}

```


